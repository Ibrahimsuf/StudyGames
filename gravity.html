<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Gravity Game</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

const terms = ["Hello", "1", "3", "5", "7"]
const defintions = ["World", "2", "4", "6", "8"]
num_terms = terms.length
console.log(num_terms)

class Demo extends Phaser.Scene {
    constructor() {
        super({
            key: 'examples'
        })
        this.printText;
        this.asteroids;
        this.score = 0;
        this.scoreText;
        this.difficulty = 0;
    }
    preload() {
        var url;
        url = 'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexbbcodetextplugin.min.js';
        this.load.plugin('rexbbcodetextplugin', url, true);
      
        url = 'https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rextexteditplugin.min.js';
        this.load.plugin('rextexteditplugin', url, true);

        this.load.image('background', 'assets/background.jpg');
        this.load.image("asteroid", "assets/asteroid.png");
    }

    create() {
        //setting background image to length of whole screen
        let background = this.add.image(this.cameras.main.width / 2, this.cameras.main.height / 2, 'background')
        let scaleX = this.cameras.main.width / background.width
        let scaleY = this.cameras.main.height / background.height
        let scale = Math.max(scaleX, scaleY)
        background.setScale(scale).setScrollFactor(0)
        this.scoreText = this.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });

        this.asteroids = this.physics.add.group({
            key: "asteroid",
            setScale: {x: .25, y: .25},
            repeat: 0,
            setXY: {x: Phaser.Math.FloatBetween(50, 750), y: 0}
        });

        let self = this
        this.asteroids.children.iterate(function (child){

            reset_asteroid(child, self)
        })

        this.printText = this.add.rexBBCodeText(400, 550, 'Type the Defintion Here', {
            color: 'black',
            fontSize: '24px',
            fixedWidth: 400,
            fixedHeight: 40,
            backgroundColor: '#EFFEFF',
            valign: 'center',
            // rtl: true
        })
            .setOrigin(0.5)
            .setInteractive()
            .on('pointerdown', function () {
                var config = {
                    onOpen: function (textObject) {
                        console.log('Open text editor');
                    },
                    onTextChanged: function (textObject, text) {
                        textObject.text = text;
                        console.log(`Text: ${text}`);
                    },
                    onClose: function (textObject) {
                        console.log('Close text editor');
                    },
                    selectAll: true,
                    // enterClose: false
                }
                this.plugins.get('rextexteditplugin').edit(this.printText, config);
            }, this);

    }

    update() {
        self = this
        this.asteroids.children.iterate(function (child){
            child.text.x = child.x
            child.text.y = child.y
            if(self.printText.text === child.defintion)
            {
                self.score += 10;
                self.difficulty += 1;
                
                self.scoreText.setText("Score: " + self.score);
                child.text.setVisible(false)
                reset_asteroid(child, self)
                document.querySelector("input").value = "";
                
                if(self.difficulty % 10 === 0)
                {
                    child = self.asteroids.create(0, 0, "asteroid").setScale(.25)
                    reset_asteroid(child, self)
                }
                
            }
            if(child.y > 600)
            {
                //game over
                this.physics.pause();
                gameOver = true;
            }
        })
     }



}

var config = {
    type: Phaser.AUTO,
    parent: 'phaser-example',
    width: 800,
    height: 600,
    physics: {
            default: "arcade",
            arcade: {
                gravity: {y: 50},
                debug: false
            }
    },
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
    },
    dom: {
        createContainer: true
    },
    
    scene: Demo
};
function reset_asteroid(child, self) {
            child.setVelocityY(-self.difficulty/20)
            child.x = Phaser.Math.Between(50, 750)
            child.y = 0
            let term_number = Phaser.Math.Between(0, num_terms - 1)
            child.term = terms[term_number]
            child.defintion = defintions[term_number]
            child.text = self.add.text(child.x, child.y, child.term, { fontSize: '25px', fill: 'black', backgroundColor: "white"});
    }

var game = new Phaser.Game(config);

</script>

</body>
</html>